## Добро пожаловать в сервис Частная территория

### Легенда
__________________________________________________________
Одна государственная компания разрабатывала сервис, который производил различные манипуляции с кадастровыми номерами.
Однако юный программист Олег решил уйти в другую компанию не обременённую бюрократией и раздутым самомнение.

Сервис Олега продолжал исправно работать, пока в один момент команда не решила, перейти на микросервисную архитектуру 
и разложить все сервисы по которые 
работали непонятно как ~~по полочкам~~ по контейнерам, что бы не решать проблемы с зависимостями и деплоем при каждом развёртывании приложения.

И вот тут случилась **Беда**. Олег совсем заблыл (или даже и не делала) написать файлы для инфраструктуры.
Осталась только документация к проекту да сам проект.

Ваша задача спасти маленькую и очень ~~без~~ полезную государственную компанию.

__________________________________________________________
### Задания
1) Создайте в корне проекта директорию _**infrastructure**_
2) Расположите в ней следующие файлы
   1) `Dockerfile` - для сборки образа приложения
   2) `docker-compose.local.yaml` - docker compose файл для развёртывания проекта локально, все сервисы запускаются в контейнере, а само приложение локально
   3) `docker-compose.yaml` - docker compose файл для продакшн


### Сервисы 
1) База данных `postgres` (не треубет команд для запуска)
2) База данных `redis` (команда для запуска - `redis-server --requirepass ${REDIS_PASSWORD}`)
3) Сервис для отложенных задач `celery` разворачивается на основе образа основного приложения (команда для запуска - `celery -A app.worker.celery worker --loglevel=info`)
4) Само приложение (команда для запуска - `sh -c "uvicorn app.main:app --host 0.0.0.0 --port 8080 --workers 4"`)

### Особенности окружений
1) **Локальное окружение** - в случае локального окружения сервисы `postgres` и `redis` должны быть доступны на `localhost` чтобы оснвное приложение могло до них достучаться.
Однако приложению `celery` понадобиться доступ к `redis` через внутреннюю сеть, **docker-compose** в коде приложения такой вариант предусмотрен, но нужно не забыть настроить всё в **Docker-compose** файле
2) **Продакшн** - все сервисы работают во внутренней сети `docker-compose` сервисы `postgres` и `redis` должны быть изолированны и доступны только `celery`  и основному сервису приложения. Само приложение должно быть доступно на **80** порту. Команду для запуска менять не надо, просто пробросьте порты.
3) В продакшн все контейнеры должны собираться из образов с docker hub

### Что должно быть в контейнере
1) Файл с зависимостями
2) Исходный код приложения `app`

### [Документация от Олега](docs/service_part.md)