# Documentation

## Dockerfile

- `FROM python:3.11-alpine`: Указывает базовый образ Python 3.11 Alpine.
- `WORKDIR src`: Устанавливает рабочий каталог внутри контейнера на `/src`.
- `COPY requirements.txt .`: Копирует файл `requirements.txt` из локального каталога в каталог `/src` внутри контейнера.
- `RUN pip install -r requirements.txt`: Устанавливает зависимости Python, указанные в файле `requirements.txt`.
- `COPY app app`: Копирует каталог `app` из локального каталога в каталог `/src` внутри контейнера.

## docker-compose.local.yaml

Этот файл docker-compose определяет сервисы для запуска приложения локально с PostgreSQL и Redis. Он включает следующие сервисы:

### postgres
- Образ: `postgres:16.2`
- Переменные среды загружаются из файла `.env`.
- Открывает порт `${DB_POSTGRES_PORT}` для хоста.

### redis_db
- Образ: `redis:7-alpine`
- Имя контейнера: `redis`
- Переменные среды загружаются из файла `.env`.
- Открывает порт `${REDIS_PORT}` для хоста.
- Настроен с паролем `${REDIS_PASSWORD}`.

### celery
- Собран на основе `infrastructure/Dockerfile`.
- Имя контейнера: `celery`
- Команда для запуска Celery worker.
- Зависит от `redis_db` и `postgres`.
- Переменные среды загружаются из файла `.env`.
- Настроен с хостами для PostgreSQL и Redis.

## docker-compose.yaml

Этот файл docker-compose определяет сервисы для запуска приложения с PostgreSQL, Redis, Celery и основным приложением. Он включает следующие сервисы:

### postgres
- Образ: `postgres:16.2`
- Переменные среды загружаются из файла `.env`.

### redis_db
- Образ: `redis:7-alpine`
- Имя контейнера: `redis`
- Переменные среды загружаются из файла `.env`.
- Настроен с паролем `${REDIS_PASSWORD}`.

### celery
- Имя контейнера: `celery`
- Команда для запуска Celery worker.
- Зависит от `redis_db` и `postgres`.
- Переменные среды загружаются из файла `.env`.
- Настроен с хостами для PostgreSQL и Redis.

### app
- Имя контейнера: `backend`
- Команда для запуска основного приложения с использованием uvicorn.
- Открывает порт `8002` на хосте, сопоставленный с портом `8080` внутри контейнера.
- Переменные среды загружаются из файла `.env`.


# Когда все 3 файла готовы, то ...


1. Сначала создается образ с именем "{your_name}" с использованием Dockerfile, который находится в каталоге infrastructure. Этот Dockerfile копирует файлы, устанавливает зависимости и копирует приложение в контейнер.

`docker build -t {your_name} -f infrastructure/Dockerfile .`
{your_name} - это имя нашего образа (пример: bondar_lab_2)


2. Затем выполняется вход в Docker Hub, чтобы получить доступ к публикации созданного образа.

`docker login`


3. После этого создается образ с именем "{name}/lab_2:latest" с использованием того же Dockerfile, что и в первом шаге.

`docker build -f infrastructure/Dockerfile -t {name}/lab_2:latest .`
 {name} - имя нашего аккаунта на Docker Hub.


4. После успешной сборки образа он публикуется в Docker Hub.

`docker push {name}/lab_2`
 {name} - имя нашего аккаунта на Docker Hub.


5. Наконец, запускаются сервисы с помощью команды:

`docker-compose up -d`

!!!мини_ИНФА!!!
------------------------------------------------------------------
-Чтобы Redis раз через раз не падал, в файле "docker-compose.yaml" прописываем `.env` и закидываем сам файл ".env" в папку "infrastructure"-

- А чтобы файл ".env" был снаружи папки, то заменяем `.env` на `../.env` и вытаскиваем файл ".env" из папки "infrastructure". НО, Redis раз через раз будет падать...GG
------------------------------------------------------------------